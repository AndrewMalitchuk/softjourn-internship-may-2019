<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<head>
    <title>User</title>
</head>
<body>
<div class="container">
    <div class="row">
        <!--        <div class="col-md-1">-->
        <!--            <label>Category:</label>-->
        <!--        </div>-->
        <div class="col-md-3">
            <select id="roleList" class="form-control"></select>
        </div>
        <div class="col-md-3">
            <button id="uploadData" type="button" class="btn btn-primary">Select</button>
        </div>
    </div>
    <div id='root'></div>
</div>
<script>
		$.ajax({
			url: "http://localhost:8080/api/user/allRoles"
		}).then(function (data) {
		    allRole=new Array();
			for(var i=0; i<Object.keys(data).length; i++){
			    allRole.push(data[i].type_user);
			}
			var uniqueRole = [];
	        $.each(allRole, function(i, el){
	            if($.inArray(el, uniqueRole) === -1) uniqueRole.push(el);
	        });
			for(var i=0; i<Object.keys(uniqueRole).length; i++){
				$('#roleList').append(new Option(uniqueRole[i], uniqueRole[i], true, true));
			}
		});
		$('#uploadData').click(function() {
			var ans=$("#roleList").val();
			$.ajax({
				url: ("http://localhost:8080/api/user/userByRole?role="+ans)
			}).then(function (data) {
				renderTable(data);
			});
		});
		function renderTable(data) {
			var len=$("#root").children().length;
			if(len!=0){
				$("#root").empty();
			}
			$("#root").append('<div class="container">\
				<table class="table table-striped">\
				<thead>\
				<tr>\
				<th>ID</th>\
				<th>Name</th>\
				<th>Surname</th>\
				<th>Sex</th>\
				<th>Date Of Birth</th>\
				<th>Address</th>\
				<th>Phone</th>\
				</tr>\
				</thead>\
				<tbody id="table_body"></tbody>\
				</table>\
				</div>');
			for(var i=0; i<Object.keys(data).length; i++){
				$("#table_body").append("<tr>\
					<th>"+data[i].idUser+"</th>\
					<td>"+data[i].name+"</td>\
					<td>"+data[i].surname+"</td>\
					<td>"+data[i].sex+"</td>\
					<td>"+data[i].dateOfBirth+"</td>\
					<td>"+data[i].address+"</td>\
					<td>"+data[i].phone+"</td>\
					</tr>");
			}
		}
	</script>
</body>
</html>